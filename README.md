import asyncio
import time
import random

# --- –ò–º–∏—Ç–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ ---

async def fetch_data(url: str, delay: float) -> str:
    """
    –ò–º–∏—Ç–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∑–∞–ø—Ä–æ—Å —Å –∑–∞–¥–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.
    """
    start_time = time.time()
    
    # 1. –ó–∞–¥–µ—Ä–∂–∫–∞: –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ 'await' –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    # –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥—Ä—É–≥–∏–º –∑–∞–¥–∞—á–∞–º –≤ event loop (—Ü–∏–∫–ª–µ —Å–æ–±—ã—Ç–∏–π) —Ä–∞–±–æ—Ç–∞—Ç—å.
    print(f"[{url}] ‚è≥ –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∞: {delay:.2f} —Å)...")
    await asyncio.sleep(delay)
    
    end_time = time.time()
    
    # 2. –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    result = f"–î–∞–Ω–Ω—ã–µ —Å {url} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã."
    print(f"[{url}] ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ {end_time - start_time:.2f} —Å.")
    
    return result

# --- –û—Å–Ω–æ–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ---

async def main_async_fetch():
    """
    –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.
    """
    
    # –°–ø–∏—Å–æ–∫ –∏–º–∏—Ç–∏—Ä—É–µ–º—ã—Ö URL –∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ (–≤—Ä–µ–º–µ–Ω–∏, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–π–º–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—è)
    tasks_data = [
        ("API-A", random.uniform(2.0, 3.0)), # –°–∞–º–∞—è –¥–æ–ª–≥–∞—è –∑–∞–¥–∞—á–∞
        ("API-B", random.uniform(0.5, 1.0)),
        ("API-C", random.uniform(1.0, 2.0)),
        ("API-D", random.uniform(0.1, 0.5)),
    ]
    
    # 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (Task)
    tasks = []
    for url, delay in tasks_data:
        # –ú—ã –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º await –∑–¥–µ—Å—å; –º—ã –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏
        task = asyncio.create_task(fetch_data(url, delay))
        tasks.append(task)
        
    # 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á
    print("\n--- ‚ö° –ù–∞—á–∏–Ω–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á ---")
    
    # asyncio.gather() –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –∂–¥–µ—Ç, –ø–æ–∫–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –í–°–ï.
    results = await asyncio.gather(*tasks)
    
    print("\n--- üèÅ –í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã ---")
    
    # 3. –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    for result in results:
        print(f"   [–†–µ–∑—É–ª—å—Ç–∞—Ç] {result}")

# --- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º ---

def main_sync_fetch(tasks_data):
    """
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –∏–º–∏—Ç–∏—Ä—É—é—â–∞—è –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –∫–æ–¥.
    """
    print("\n--- üêå –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ---")
    
    # –í —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ, –µ—Å–ª–∏ –º—ã –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å time.sleep(), 
    # –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø –¥–æ –µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
    
    for url, delay in tasks_data:
        # –ò–º–∏—Ç–∏—Ä—É–µ–º –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, requests.get –±–µ–∑ asyncio)
        print(f"[{url}] ‚è≥ –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∞: {delay:.2f} —Å)...")
        time.sleep(delay) # –ë–õ–û–ö–ò–†–£–ï–¢ –í–ï–°–¨ –ü–†–û–¶–ï–°–°
        print(f"[{url}] ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ.")
        
    print("--- üèÅ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ---")
    
# --- –ì–ª–∞–≤–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã ---

if __name__ == "__main__":
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–µ–∏—Ö –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π
    TASKS_DATA = [
        ("API-1", 2.5),
        ("API-2", 1.0),
        ("API-3", 3.0), # –°–∞–º–∞—è –¥–æ–ª–≥–∞—è –∑–∞–¥–∞—á–∞
        ("API-4", 0.5),
    ]
    
    # 1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ)
    sync_start = time.time()
    main_sync_fetch(TASKS_DATA)
    sync_duration = time.time() - sync_start
    print(f"\n–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è: {sync_duration:.2f} —Å. (–°—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–¥–µ—Ä–∂–µ–∫)")
    print("-" * 60)

    # 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ)
    async_start = time.time()
    # –ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–æ–±—ã—Ç–∏–π
    asyncio.run(main_async_fetch())
    async_duration = time.time() - async_start
    
    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–ª–∏–∑–∫–æ –∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–º–æ–π –î–û–õ–ì–û–ô –∑–∞–¥–∞—á–∏
    print(f"\n–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è: {async_duration:.2f} —Å. (–í—Ä–µ–º—è —Å–∞–º–æ–π –¥–æ–ª–≥–æ–π –∑–∞–¥–∞—á–∏)")
    print("-" * 60)
    
    print(f"–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ {sync_duration - async_duration:.2f} —Å –±—ã—Å—Ç—Ä–µ–µ.")
